# 데드락(Deadlock)
시스템 자원에 대한 요구가 뒤엉킨 상태, 둘 이상의 프로세스가 다른 프로세스가 점유하고 있는 자원을 서로 기다릴 때 무한 대기에 빠지는 상황

## 발생조건
- 상호배제
    - 한 번에 프로세스 하나만 해당 자원을 사용할 수 있다
    - 사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때 까지 기다려야 한다
- 점유대기
    - 자원을 최소 하나 보유하고 다른 프로세스에 할당된 자원을 점유하기 위해 대기하는 프로세스가 존재해야 한다
- 비선점
    - 이미 할당된 자원을 강제로 빼앗을 수 없다
- 순환대기
    - 대기 프로세스의 집합이 순환 형태로 자원을 대기하고 있어야 한다

<br>

## 해결법
- 데드락이 발생하지 않도록 예방(Prevention)
- 데드락 발생 가능성을 인정하면서도 적절하게 회피(Avoidance)
- 데드락 발생을 허용하지만 데드락을 탐지(Detection), 회복(Recovery)

<br>

### 데드락 예방(Prevention)
- 자원의 상호 배제 조건 방지
    - 한 번에 여러 프로세스가 공유 자원을 사용할 수 있게 한다
- 점유 대기 조건 방지
    - 프로세스 실행에 필요한 모든 자원을 한꺼번에 요구하고 허용할 때까지 작업을 보류, 나중에 또다른 자원을 점유하기 위한 대기 조건을 성립하지 않도록 한다
- 비선점 조건 방지
    - 이미 다른 프로세스에게 할당된 자원이 선점권이 없다고 가정할 때, 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 한다
- 순환 대기 조건 방지
    - 자원을 순환 형태로 대기하지 않도록 일정한 한 쪽 방향으로만 자원을 요구할 수 있도록 한다

이러한 예방 방법은 시스템의 처리량이나 효율성을 떨어트리는 단점이 발생할 수 있다

<br>

### 데드락 회피(Avoidance)
데드락 발생 전에 데드락을 예상하고 Safe State(안전한 상태)에서만 자원을 요청 허용하는 방법
- 은행원 알고리즘
    - 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는 것에 유래
- 프로세스가 자원을 요구할 때, 해당 자원을 할당 후에도 safe state인지 사전에 검사 후 데드락 회피
    - safe state면 자원 할당, 아니면 다른 프로세스들이 자원 해지를 할 때까지 대기


### 데드락 탐지(Detection) & 회복(Recovery)
- 탐지
    - 자원 할당 그래프를 통해 데드락인지 아닌지 탐지 알고리즘(Allocation, Request, Available)으로 판단 (오버헤드 발생 가능성 있음)
- 회복 : 프로세스 종료 -> 자원 회복
    - 데드락이 제거될 때까지 하나씩 중지
    - 데드락 상태의 프로세스 모두 중지
    - 우선 순위가 낮은 프로세스나 수행 횟수가 적은 프로세스 위주로 먼저 선점하도록 함
    - 데드락 상태의 프로세스를 일시정지 시킨 후 점유했던 자원을 선점하여 다른 프로세스에게 할당