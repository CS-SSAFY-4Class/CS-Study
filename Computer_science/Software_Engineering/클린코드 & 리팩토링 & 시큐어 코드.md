# Clean code & Refactoring & Secure coding

<br>
<hr>

# 1. 클린코드

## 나쁜코드

<br>

### 예시

1. 르블랑의 법칙 : 나중은 결코 오지 않는다.
    - 나중에 손보겠다고 다짐한 코드. 일단은 작동을 하는 프로그램에 대충 짠 코드를 나중에 다시 손보겠다 다짐했지만, 정작 코드를 뜯어 고쳐야할 때가 오면 이미 늦은 것이다.

2. 실제로 80년대 후반, 출시를 앞두고 급하게 코드를 짠 회사가 있었는데 얼마 후 문을 닫게 되었다. 그 이유는 막 짠 코드들이 쌓여 손쓸 수 없이 쌓여버린 탓이다.

3. 프로젝트 단위로 협업이 필수인 업계에서 "나쁜 코드"는 개발 속도를 저하시키고, 악순환의 반복으로 생산성 또한 떨어지게 된다.

### 요약

1. 코드 가독성이 떨어짐
2. 코드의 규약이 없음
3. 코드의 결합도가 높음
4. (시간이 없어서) 땜빵코드로 막 구현한 코드
5. 기타 등등

<br>

## 깨끗한 코드

<br>

### 비야네 스트롭스트룹 
- C++ 창시자

1. 우아하고 효율적인 코드
    - 보기에 깔끔하고 속도적인 이점 뿐 아니라, CPU 자원을 또한 낭비하지 않는 것.
2. "깨끗한 코드"는 한가지를 제대로 한다.
    - 각 함수와 클래스와 모듈은 "한가지" 일을 잘한다.
3. 의존성을 최대한 줄여야 유지보수가 쉬워진다.

<br>

### 그래디 부치
- '객체지향적 분석과 디자인(OOAD)' 저자

1. 단순하고 직접적인 코드
2. 설계자의 의도를 숨기지 않는 코드
3. 명쾌한 추상화와 단순한 제어문을 사용하는 코드

<br>

### 데이브 토마스
- OTI 창립자, 이클립스 전략의 대부

1. 작성자가 아닌 사람도 읽기 쉽고 고치기 쉬운 코드
2. 단위 테스트 케이스와 인수 테스트 케이스가 존재해야 한다.
    1. 단위 테스트 케이스 : 테스트 가능한 가장 작은 소프트웨어를 실행하여 동작을 표현하기 위한 테스트 케이스
        - 테스트 케이스를 작게 설정 가능할수록 더욱 간단하며 깔끔한 코드란 뜻.
    2. 인수 테스트 케이스 : 비즈니스에 초점을 두어, 사용자 스토리(시나리오)에 맞춰 수행하는 테스트 케이스
3. 의미있는 이름이 붙는다.
4. 특정 목적을 달성하는 방법은 하나만 제공하며, 각 코드의 의존성을 최소로 하고 그 정의를 명확히 한다.
5. 필요한 모든 정보를 코드만으로 명확히 표현할 수 없기 때문에, 코드는 문학적으로 표현해야 한다.

<br>

### 마이클 페더스
- "Working Effectively with Legacy" 저자
    - legacy : 남이 남긴 코드, 누군가가 남기고 가서 코드만 보고 이해해야 함을 뜻한다.

1. 다른 사람들이 봤을 때 주의 깊게 짰다는 느낌을 받게하는 코드
2. 고치려고 봐도 딱히 손댈 곳 없는 코드
    - 모든 사항에 대해 고려하였고, 이해하기에 편한 코드

<br>

#### 위를 정리하면 아래와 같다.
<br>

1. Naming _ 이름 짓기

    - 변수, 클래스, 메소드, 함수 등 식별자에 의도가 분명한 이름을 사용한다.

<br>

2. Comment _ 주석

    - 설명이 필요한 코드에는 작성해야 하지만, 빠르게 유추 가능한 코드에는 되도록 작성하지 않는다.
    - 설명을 위한 설명은 달지 않는다.

<br>

3. Aesthetics _ 꾸미기

    - 들여쓰기, 줄바꿈을 적절히 사용하여 가독성을 향상시킨다.

<br>

4. Making control flow easy to read _ 흐름 제어

    - 왼쪽에 변수, 오른쪽에 상수를 두고 비교한다.
    - 조건문은 긍정을 기준으로 다룬다.
    - if/else를 사용하며, 삼항 연산자는 간단한 경우에만 사용한다.
    - do/while 루프의 사용은 가급적 피한다.

<br>

5. Function _ 함수 이용

    - 함수는 가급적 작게, 하나의 작업을 위해서 만든다.
    - main 함수에 최소한의 정보만을 담는다.

<br>
<hr>

# 2. 리팩토링

<br>

## 정의

- '결과의 변경 없이 코드의 구조를 재조정함'을 뜻한다.

    - 기능을 유지하되, 읽기 좋고 지속적으로 관리하기 편하게 소스코드를 재작성 하는 것.
    - 성능의 최적화와는 다른 접근.

<br>

- Legacy 코드를 만날 가능성이 높은 협업단계에서 모든 개발자들이 가져야할 단계.

    - (마이클 페더스)Legacy code : 테스트가 불가능하거나 기능이 정상적이지 않거나, 난해한 코드

<br>

## 리팩토링 시점

1. 유사한 내용이 3번 이상 반복할 때

    - 무조건 하는 것은 아니고, 상황에 따라 잘 판단하여야 한다.

<br>

2. 새로운 기능을 추가해야 할 때

    - 현재 작성된 소스코드에서 새로운 기능을 추가하기 어려워 보이면 리팩토링을 해야 한다.

<br>

3. 코드리뷰를 할 때

    - 협업하는 개발팀과 함께하는 코드 리뷰는 질을 높인다.

<br>

4. 기타 등등

<br>

## 리팩토링 단계

1. 변경지점 식별

    - 코드를 직접 만지기 전에 설계 단계가 필요하다.

<br>

2. 테스트 지점 찾기

    - 가장 간단한 판단 기준은 모든 메서드에 대해 테스트를 수행하는 것이다.

<br>

3. 의존관계 깨기

    - 의존관계 : 다른 클래스나 인터페이스에 방향성을 가지고 의지하는 코드
    - (예시) A 클래스에서 B 클래스에 있는 메서드를 호출. A 클래스는 B 클래스에 의지한다.

<br>

4. 테스트 루틴 작성

    - 코드의 동작을 이해하는데 필요하다고 느끼는 만큼 사례를 작성해야 한다.
    - 사례별로 동작들의 존재 여부와 연결을 검증할 수 있는 테스트 루틴을 작성한다.

<br>

5. 변경

<br>
<hr>

# 3. 시큐어 코딩

<br>

## 정의

- 안전한 소프트웨어 개발을 위해 소스코드 등에 존재할 수 있는 잠재적인 보안 취약점을 제거하고, 보안을 고려한 기능을 구현하는 등 소프트웨어 개발과정에서 지켜야 할 일련의 보안 활동이다.

<br>

## 가이드

1. 시큐어 코딩은 개발단계에서 적용되기 때문에 개발자의 코딩 작업이 핵심 대상이다.
2. 하지만! 개발자로서 취약점을 모두 고려하는 프로그래밍이란 매우 어려운 일이다.
3. 따라서! 국내에서는 2012년 12월부터 행정안전부에 의해 시큐어 코딩에 대한 법규가 제정, 시행되어 그 기준을 제시하고 있다.

<br>

- 행정안전부에 의해 제정된 법규의 대상은 다음과 같다. <br>
![행안부 지침](./images/%ED%96%89%EC%A0%95%EC%95%88%EC%A0%84%EB%B6%80%2021%EB%85%84%20%EA%B3%A0%EC%8B%9C.png)

<br>

- 행정안전부에서 개발 보안 가이드(지침서)를 제공하고 있다.
    - [소프트웨어_개발보안_가이드](https://www.mois.go.kr/frt/bbs/type001/commonSelectBoardArticle.do;jsessionid=TjAX2IwVk6hpONx8dKSZ4VTj.node10?bbsId=BBSMSTR_000000000015&nttId=88956#none)
<br>

![행안부 약점 항목](./images/%ED%96%89%EC%A0%95%EC%95%88%EC%A0%84%EB%B6%80%2021%EB%85%84%20%EA%B3%A0%EC%8B%9C2.png)

<br>

### 각 항목에 대한 세부 설명

1. 입력데이터 검증 및 표현

    - 사용자가 비정상적인 데이터를 입력하여 시스템에 손상을 주거나, 정보를 수정 및 탈취하지 못하도록 방지하는 것
    - 해커가 입력한 데이터를 확인해 공격 시도로 의심되는 단어를 치환하거나 차단하는 방식으로 이용

<br>

2. 보안 기능

    - 소프트웨어 개발 구현단계에서 인증, 접근제어, 기밀성, 암호화 등을 올바르게 구현하기 위한 보안 항목.
    - 암호와 같이 중요한 암호를 암호와 없이 저장하거나, 프로그램 내부에 하드 코딩되어 노출의 위험성이 있는 경우 필요

<br>

3. 시간 및 상태

    - 동시 또는 동시 수행을 지원하는 병렬 시스템이나, 하나 이상의 프로세스가 동작하는 환경에서 시간 및 상태를 부적절하게 관리하여 발생할 수 있는 보안 약점을 관리하는 것.
    - 종료되지 않는 반복문이나 재귀문을 사용하여 무한루프에 빠지는 것도 포함된다.

<br>

4. 에러 처리

    - 에러를 처리하는 방식이 부적절하거나 누락되어 발생하는 보안 약점에 대한 항목.
    - 에러 메시지는 시스템과 관련된 중요 정보를 포함하는 경우가 많아 주의해야 한다.

<br>

5. 코드 오류

    - 구현단계에서 개발자으 실수나 지식 미달로 인한 오류를 예방하기 위한 점검 항목.
    - (예시) Null 값을 체크하지 않고 변수를 사용하거나, 스레드와 같은 자원을 무한하게 할당하여 시스템에 부하를 주는 경우가 있다.

<br>

6. 캡슐화

    - 객체 지향 방법론에 중요한 개념으로, 객체와 필드의 은닉을 통해 외부의 잘못된 사용을 방지하는 것.
    - 잘못된 방법으로 캡슐화 하거나 불충분했을 경우 보안 취약점으로 작용하는 경우가 있다.

<br>

7. API 오용

    - 응용프로그램에서 운영체제나 프로그래밍 언어가 제공하는 기능을 제어할 수 있게 만든 인터페이스.
    - 개발자는 편리하게 개발하고, 유용한 정보를 얻기 위해 API를 이용한다.
    - 보안에 취약한 API의 이용이나, 의도된 사용에 반하는 방법으로 API를 이용하면 심각한 보안 취약점을 노출할 수 있다.

<br>
<br>

> reference

- 클린코드 by Robert C. Martin (출판사: 인사이트)
- [클린코드&리팩토링&시큐어코딩](https://velog.io/@yuseogi0218/%ED%81%B4%EB%A6%B0%EC%BD%94%EB%93%9C-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81-%EC%8B%9C%ED%81%90%EC%96%B4-%EC%BD%94%EB%94%A9)
- [리팩토링이란?](https://ikkison.tistory.com/82)
- [레거시 코드](https://drehzr.tistory.com/56)
- [시큐어 코딩](http://www.incodom.kr/%EC%8B%9C%ED%81%90%EC%96%B4%EC%BD%94%EB%94%A9%28SecureCoding%29)
- [소프트웨어 개발보안 가이드](https://www.mois.go.kr/frt/bbs/type001/commonSelectBoardArticle.do;jsessionid=TjAX2IwVk6hpONx8dKSZ4VTj.node10?bbsId=BBSMSTR_000000000015&nttId=88956#none)
